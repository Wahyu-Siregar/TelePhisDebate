flowchart TB
  subgraph L1["L1 Input / Perception"]
    Msg[Telegram Message]
  end

  subgraph L2["L2 Preprocessing & Features"]
    Handler[MessageHandler\nText + Sender Info]
  end

  subgraph L3["L3 Rule-Based Screening"]
    Triage[RuleBasedTriage\nWhitelist/Blacklist/Behavioral]
  end

  subgraph L4["L4 LLM Routing"]
    SingleShot[Single-Shot Classifier]
  end

  subgraph L5["L5 Agent Analysis"]
    Content[ContentAnalyzer]
    Security[SecurityValidator]
    Social[SocialContextEvaluator]
  end

  subgraph L6["L6 Multi-Agent Synthesis"]
    Orchestrator[Debate Orchestrator]
    Aggregator[VotingAggregator\nConsensus]
  end

  subgraph L7["L7 Action & Observability"]
    Actions[BotActions\nWarnings/Delete/Admin]
    Logs[Supabase Logs]
    Dashboard[Dashboard]
  end

  Msg --> Handler
  Handler --> Triage
  Triage --> SingleShot
  SingleShot --> Content
  SingleShot --> Security
  SingleShot --> Social
  Content --> Orchestrator
  Security --> Orchestrator
  Social --> Orchestrator
  Orchestrator --> Aggregator
  Aggregator --> Actions
  Handler --> Logs
  Dashboard --> Logs
