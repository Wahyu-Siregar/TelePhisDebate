@startuml
title TelePhisDebate - System Architecture

skinparam componentStyle rectangle
skinparam linetype ortho

actor "Telegram User" as User
cloud "Telegram API" as Telegram
cloud "DeepSeek API\n(LLM)" as DeepSeek

node "TelePhisDebate Runtime" {
  component "TelePhisBot\n(src/bot/bot.py)" as Bot
  component "MessageHandler\n(src/bot/handlers.py)" as Handler
  component "Detection Pipeline\n(src/detection/pipeline.py)" as Pipeline
  component "Rule-Based Triage\n(src/detection/triage/*)" as Triage
  component "Single-Shot LLM\n(src/detection/single_shot/classifier.py)" as SingleShot
  component "Multi-Agent Debate\n(src/detection/mad/*)" as MAD
  component "BotActions\n(src/bot/actions.py)" as Actions
  database "Supabase\n(src/database/client.py)" as DB
  component "Dashboard (Flask)\n(src/dashboard/app.py)" as Dashboard
}

User --> Telegram : send message
Telegram --> Bot : update
Bot --> Handler : dispatch update
Handler --> Pipeline : process_message()

Pipeline --> Triage : analyze()
Pipeline --> SingleShot : classify()
SingleShot --> DeepSeek : chat_completion()
Pipeline --> MAD : run_debate()
MAD --> DeepSeek : agent analysis (3x)

Pipeline --> Actions : action decision
Actions --> Telegram : warn/delete/notify

Handler --> DB : log detection + messages
Dashboard --> DB : read stats/logs
User <-- Telegram : warnings/status

@enduml
