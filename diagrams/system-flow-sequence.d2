direction: down

User: "User"
Telegram: "Telegram API"
Bot: "TelePhisBot"
Handler: "MessageHandler"
Pipeline: "DetectionPipeline"
Triage: "RuleBasedTriage"
SingleShot: "SingleShotClassifier"
MAD: "MultiAgentDebate"
Actions: "BotActions"
DB: "Supabase"

User -> Telegram: "send message"
Telegram -> Bot: "update"
Bot -> Handler: "handle_message()"
Handler -> Pipeline: "process_message(text, metadata)"
Pipeline -> Triage: "analyze()"

DecisionTriage: "Triage skip_llm?" { shape: diamond }
Triage -> DecisionTriage
DecisionTriage -> ResultSafe: "Yes"
DecisionTriage -> SingleShot: "No"

ResultSafe: "Result: SAFE"
SingleShot -> DecisionLLM: "classification + confidence"
DecisionLLM: "High confidence?" { shape: diamond }
DecisionLLM -> ResultLLM: "Yes"
DecisionLLM -> MAD: "No"

MAD -> ResultMAD: "decision + confidence"
ResultLLM: "Result: LLM"
ResultMAD: "Result: MAD"

ResultSafe -> Actions: "execute_action()"
ResultLLM -> Actions: "execute_action()"
ResultMAD -> Actions: "execute_action()"
Actions -> Telegram: "warn/delete/notify"
Handler -> DB: "log detection + message"
