flowchart LR
  User((Telegram User))
  Telegram([Telegram API])
  DeepSeek([DeepSeek API\n(LLM)])
  Supabase[(Supabase)]

  subgraph Runtime[TelePhisDebate Runtime]
    Bot[TelePhisBot\n(src/bot/bot.py)]
    Handler[MessageHandler\n(src/bot/handlers.py)]
    Pipeline[Detection Pipeline\n(src/detection/pipeline.py)]
    Triage[Rule-Based Triage\n(src/detection/triage/*)]
    SingleShot[Single-Shot LLM\n(src/detection/single_shot/classifier.py)]
    MAD[Multi-Agent Debate\n(src/detection/mad/*)]
    Actions[BotActions\n(src/bot/actions.py)]
    Dashboard[Dashboard (Flask)\n(src/dashboard/app.py)]
  end

  User -->|send message| Telegram
  Telegram -->|update| Bot
  Bot -->|dispatch update| Handler
  Handler -->|process_message()| Pipeline

  Pipeline -->|analyze()| Triage
  Pipeline -->|classify()| SingleShot
  SingleShot -->|chat_completion()| DeepSeek
  Pipeline -->|run_debate()| MAD
  MAD -->|agent analysis (3x)| DeepSeek

  Pipeline -->|action decision| Actions
  Actions -->|warn/delete/notify| Telegram

  Handler -->|log detection + messages| Supabase
  Dashboard -->|read stats/logs| Supabase
  Telegram -->|warnings/status| User
